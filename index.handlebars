<!DOCTYPE html>
<html>
<head>
    <script type="text/javascript" src="http://js.nicedit.com/nicEdit-latest.js"></script> 
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <link href="https://code.jquery.com/ui/1.11.1/themes/ui-darkness/jquery-ui.css" rel="stylesheet"/>
    <script src="https://code.jquery.com/ui/1.11.1/jquery-ui.min.js"></script>
    <script type="text/javascript" src="http://www.javascripttoolbox.com/libsource.php/mktree/source/mktree.js"></script>
    <link rel="stylesheet" href="http://www.javascripttoolbox.com/lib/mktree/mktree.css" type="text/css">
    <!--<link rel="stylesheet" href="nicEdit.css">-->
    <link rel="stylesheet" href="style.css">
    <script src="https://use.fontawesome.com/d505c5f630.js"></script>
    <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
    <style>
        body, html{
            width:100%;
            height:100%;
            padding: 0;
            margin: 0;
        }

        header{
            width:100%;
            height: 50px;
        }

        section{
            width: 100%;
            height: calc(100% - 70px);
        }

        footer{
            width: 100%;
            height: 10px;
        }

        #container {
            display: flex;
        }

        #clauses-container {
            width: 150px;
            background: white;
        }

        #features-container {
            width: 500px;
            background: white;
        }

        #editor-container {
            flex: 1;
            background: white;
        }
    </style>
</head>

<body>
    <script>
        bkLib.onDomLoaded(function() {
            window.nicEdit = new nicEditor({
                maxHeight : 500,
                fullPanel : true
            }).panelInstance('area');
        });

        function addText(id) {
            var nicE = new nicEditors.findEditor('area');
            var map = {};
            map["A1"] = "<div align='center'><h1>PURCHASE AND SALE AGREEMENT <BR>BETWEEN<BR>_______________________<BR>AND<BR>________________________<BR></H1>";
            map["A2"] = "Clause A2";
            map["B1"] = "<u>Sale of Equipment.</u>  Company hereby sells to Buyer and Buyer hereby purchases from Company the equipment described on <u>Exhibit A</u> attached hereto and incorporated herein, and licenses the software contained therein (hereinafter 'Equipment').  Such Equipment shall be shipped FOB Installation Site (as hereinafter defined in Paragraph 6), freight pre-paid and absorbed by Company.";
            map["B2"] = "<ul>Sale of Services.</ul> Company hereby sells to Buyer and Buyer hereby purchases from Company the equipment described on <u>Exhibit B</u> attached here";
            console.log("Current Content: ");
            console.log(nicE.getContent());
            nicE.setContent(nicE.getContent() + "<div class='Clause' id='" + id + "'>" + map[id.toString()] + "</div> <br>");
            $('#editor-container').trigger('onClauseAddition', [{"id" : id}]);
        }
        (function($) {
            $.QueryString = (function(a) {
                if (a == "") return {};
                var b = {};
                for (var i = 0; i < a.length; ++i)
                {
                    var p=a[i].split('=', 2);
                    if (p.length != 2) continue;
                    b[p[0]] = decodeURIComponent(p[1].replace(/\+/g, " "));
                }
                return b;
            })(window.location.search.substr(1).split('&'))
        })(jQuery);
    </script>
    <header style="text-align:center;">
        <h1>Real Time Contract Editor - <script>document.write($.QueryString['user'])</script> </h1>
    </header>
    <section>
        <div id="container">
            <div id="clauses-container" style="width:400px">
                <h3 style="text-align:center;"><u>Clause Library</u></h3>
                <ul class="mktree" id="tree1" >
                     <li id = "Title" href="#" class="liClosed" onClick="expandToItem('tree1','A'); return false;">Title
                    <ul>
                        <li id="A1" href="#" onClick="addText('A1')">Main Title</li>
                        <li id="A2" href="#" onClick="addText('A2')">Sub Title</li>
                    </ul> 
                </li>
                     <li id = "B" href="#" class="liClosed" onClick="expandToItem('tree1','B'); return false;">Sale
                    <ul>
                        <li id="B1" href="#" onClick="addText('B1')">Sale of Equipment</li>
                        <li id="B2" href="#" onClick="addText('B2')">Sale of Services</li>
                    </ul> 
                </li>
                </ul>
            </div>
            <div id="editor-container" ondrop="dropped(event)">
                <textarea id="area" ondrop="dropped(event)" ondragover="return false" style="height:550px" cols="125">
                </textarea>
                <!--<button id="but" draggable="true" onclick="getContent()">Get Content</button>-->
            </div>
            <div id="features-container">
                Enter Chat and press enter
                <div><input id=input placeholder=you-chat-here /></div>

                Chat Output
                <div id=box></div>

                <script src='http://cdn.pubnub.com/pubnub.min.js'></script>
                <script>(function(){
                    var box = PUBNUB.$('box'), input = PUBNUB.$('input'), channel = 'chat';
                    PUBNUB.subscribe({
                        channel  : channel,
                        callback : function(text) { box.innerHTML = (''+text).replace( /[<>]/g, '' ) + '<br>' + box.innerHTML }
                    });
                    PUBNUB.bind( 'keyup', input, function(e) {
                        (e.keyCode || e.charCode) === 13 && PUBNUB.publish({
                            channel : channel, message :  $.QueryString['user'] + ' : ' + input.value, x : (input.value='')
                        })
                    } )
                })()</script>
                <div class="chat-container">
                    <div class="row chat-window" id="chat_window_1">
                        <div class="col-xs-12 col-md-12">
                            <div class="chat-panel chat-panel-default">
                                <div class="chat-panel-heading chat-top-bar">
                                    <div class="col-md-8 col-xs-8">
                                        <i class="fa fa-comments-o" aria-hidden="true" style="color:black"></i>
                                        <label for="Name" class="widget-label" style="color:black">Contract Assistant</label>
                                    </div>
                                    <div class="col-md-4 col-xs-4" style="text-align: right;">
                                        <a><span id="minim_chat_window" class="glyphicon glyphicon-minus icon_minim"></span></a>
                                    </div>
                                </div> <!-- End of Chat Panel Heading-->
                                <div class="chat-panel-body msg_container_base">
                                </div> <!-- End of Chat Panel Body-->
                                <div class="chat-panel-footer">
                                    <input id="chat-input" type="text" class="form-control input-sm chat_input" placeholder="Write your message here..." />
                                    <div class="input-group">
                                    </div>
                                </div> <!-- End of Chat Panel Footer-->
                            </div> <!-- End of Chat Panel -->
                        </div>
                    </div> <!-- End of chat Window -->
                </div> <!-- End of chat Container -->
            </div> <!-- End of features Container -->
        </div>
    </section>
    <footer style="text-align:center;">
        <h6>SAP Ariba, Innovation 2016</h6>
    </footer>

    <script type="text/html" id="chat-bot-msg-sent-template">
        <div class="row msg_container base_sent">
            <div class="col-md-10 col-xs-10">
                <div class="chat-messages msg_sent">
                </div>
            </div>
            <div class="col-md-2 col-xs-2 avatar">
                <img src="/user.png" class=" img-responsive">
            </div>
        </div>
    </script>

    <script type="text/html" id="chat-bot-msg-receive-template">
        <div class="row msg_container base_receive">
            <div class="col-md-2 col-xs-2 avatar">
                <img src="/bot.png" class=" img-responsive ">
            </div>
            <div class="col-md-10 col-xs-10">
                <div class="chat-messages msg_receive">
                </div>
            </div>
        </div>
    </script>
</body>
    
</html>